{% extends "base.html" %}

{% block content %}
<div class="container py-4">

  <!-- Optional gradient header strip to match Mentora vibe -->
  <div class="mb-4 p-3 rounded-3"
       style="background: linear-gradient(135deg, #5b2aa8, #b38cff, #ffb6ff); color: #050415;">
    <h1 class="h3 mb-0">
      Mentor Profile ¬∑ {{ mentor.user.get_full_name|default:mentor.user.username }}
    </h1>
  </div>

  <div class="row">
    <!-- LEFT: Mentor card -->
    <div class="col-lg-4 mb-4">
      <div class="card shadow-sm h-100 border-0"
           style="background: #110b24; color: #f5f0ff;">
        <div class="card-body text-center">

          {# Profile photo or initial bubble #}
          {% if mentor.photo %}
            <img src="{{ mentor.photo.url }}"
                 alt="{{ mentor.user.get_full_name|default:mentor.user.username }}"
                 class="rounded-circle mb-3"
                 style="width: 120px; height: 120px; object-fit: cover; border: 3px solid #b38cff;">
          {% else %}
            <div class="rounded-circle d-inline-flex align-items-center justify-content-center mb-3"
                 style="
                   width: 120px; height: 120px;
                   font-size: 2.5rem;
                   color: #f5f0ff;
                   background: radial-gradient(circle at top left, #b38cff, #5b2aa8);
                 ">
              {{ mentor.user.username|first|upper }}
            </div>
          {% endif %}

          <h2 class="h4 mb-1">
            {{ mentor.user.get_full_name|default:mentor.user.username }}
          </h2>

          <p class="text-muted mb-1">
            {{ mentor.get_role_display }}
          </p>

          {# FOLLOWING BADGE (read-only status) #}
          {% if is_following %}
            <span class="badge rounded-pill mb-2"
                  style="background: linear-gradient(135deg, #1dd1a1, #10ac84);">
              ‚úì Following
            </span>
          {% endif %}

          {# Hourly rate #}
          {% if mentor.hourly_rate %}
            <p class="mb-2">
              <span class="badge rounded-pill"
                    style="background: linear-gradient(135deg, #ff9ff3, #f368e0);">
                ${{ mentor.hourly_rate }} / hour
              </span>
            </p>
          {% endif %}

          {# Average rating #}
          {% if avg_rating %}
            <p class="mb-1">
              ‚≠ê <strong>{{ avg_rating|floatformat:1 }}/5</strong>
            </p>
          {% else %}
            <p class="text-muted mb-1">
              No reviews yet
            </p>
          {% endif %}

          {# Skills as colorful pills #}
          {% if mentor.skills %}
            <div class="mt-3">
              {% for skill in mentor.skills.split(",") %}
                {% if skill.strip %}
                  <span class="badge me-1 mb-1"
                        style="background: linear-gradient(135deg, #5b2aa8, #b38cff);">
                    {{ skill.strip }}
                  </span>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}

          <hr class="my-3" style="border-color: rgba(245,240,255,0.1);">

          {# MAIN CTA: Book Session via schedule page (per-mentor) #}
{% if mentor.calendly_url %}
  <a href="{% url 'schedule' mentor.id %}"
     class="btn btn-primary w-100 mb-2"
     style="background: linear-gradient(135deg, #5b2aa8, #b38cff); border: none;">
    üìÖ Book a Session
  </a>
{% else %}
  <p class="text-muted mb-2">
    This mentor has not added a scheduling link yet.
  </p>
{% endif %}

          {# FOLLOW / UNFOLLOW BUTTON (simple toggle link) #}
          {% if user.is_authenticated and user.profile != mentor %}
            {% if is_following %}
              <a href="{% url 'toggle_follow' mentor.id %}"
                 class="btn btn-outline-light w-100">
                Unfollow
              </a>
            {% else %}
              <a href="{% url 'toggle_follow' mentor.id %}"
                 class="btn btn-outline-light w-100">
                Follow
              </a>
            {% endif %}
          {% endif %}

        </div>
      </div>
    </div>

    <!-- RIGHT: About, Availability, Reviews -->
    <div class="col-lg-8 mb-4">

      <!-- About card -->
      <div class="card shadow-sm mb-4 border-0"
           style="background: #120f26; color: #f5f0ff;">
        <div class="card-body">
          <h3 class="h5 mb-3">About</h3>
          {% if mentor.bio %}
            <p class="mb-0">{{ mentor.bio }}</p>
          {% else %}
            <p class="text-muted mb-0">This mentor hasn‚Äôt added a bio yet.</p>
          {% endif %}
        </div>
      </div>

      <!-- Availability card -->
      <div class="card shadow-sm mb-4 border-0"
           style="background: #120f26; color: #f5f0ff;">
        <div class="card-body">
          <h3 class="h5 mb-3">Availability</h3>

          {% if availabilities %}
            <ul class="list-group list-group-flush">
              {% for slot in availabilities %}
                <li class="list-group-item d-flex justify-content-between align-items-center"
                    style="background: #120f26; color: #f5f0ff; border-color: rgba(245,240,255,0.05);">
                  <span>{{ slot.day_of_week|title }}</span>
                  <span>{{ slot.start_time }} ‚Äì {{ slot.end_time }}</span>
                </li>
              {% endfor %}
            </ul>
          {% else %}
            <p class="text-muted mb-0">
              This mentor hasn‚Äôt added their availability yet.
            </p>
          {% endif %}
        </div>
      </div>

      <!-- Reviews card -->
      <div class="card shadow-sm border-0"
           style="background: #120f26; color: #f5f0ff;">
        <div class="card-body">
          <h3 class="h5 mb-3">Reviews</h3>

          {% if reviews %}
            {% for review in reviews %}
              <div class="mb-3 pb-3"
                   style="border-bottom: 1px solid rgba(245,240,255,0.06);">
                <div class="d-flex justify-content-between align-items-center">
                  <strong>‚≠ê {{ review.rating }}/5</strong>
                  <small class="text-muted">
                    {{ review.created_at|date:"M d, Y" }}
                  </small>
                </div>
                {% if review.comment %}
                  <p class="mb-0 mt-2">{{ review.comment }}</p>
                {% else %}
                  <p class="mb-0 mt-2 text-muted">No comment provided.</p>
                {% endif %}
              </div>
            {% endfor %}
          {% else %}
            <p class="text-muted mb-0">
              No reviews have been left for this mentor yet.
            </p>
          {% endif %}
        </div>
      </div>

    </div>
  </div>
</div>
{% endblock %}
