{% extends "base.html" %}

{% block content %}
<div class="container mt-4" style="max-width: 800px;">

  <div class="d-flex justify-content-between align-items-center mb-3">
    <h1 class="h3 mb-0">Inbox</h1>

    {% if contacts %}
      <!-- + New Message button -->
      <button class="btn btn-primary btn-sm"
              type="button"
              data-bs-toggle="collapse"
              data-bs-target="#newMessageCollapse"
              aria-expanded="false"
              aria-controls="newMessageCollapse">
        + New Message
      </button>
    {% endif %}
  </div>

  <!-- New message contact picker -->
  {% if contacts %}
    <div class="collapse mb-3" id="newMessageCollapse">
      <div class="card">
        <div class="card-body">
          <h5 class="card-title mb-3">
            {% if user.profile.role == "MENTEE" %}
              Mentors you follow
            {% else %}
              Mentees who follow you
            {% endif %}
          </h5>

          <ul class="list-unstyled mb-0">
            {% for c in contacts %}
              <li class="d-flex justify-content-between align-items-center mb-2">
                <a href="{% url 'conversation' c.id %}">
                  {{ c.user.username }}
                </a>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
  {% endif %}

  <!-- Existing conversations (one row per partner) -->
  {% if threads %}
    <ul class="list-group">
      {% for t in threads %}
        <li class="list-group-item">
          <a href="{% url 'conversation' t.other.id %}">
            {{ t.other.user.username }}
          </a>
          <span class="text-muted small ms-2">
            {{ t.sent_at|date:"M d, Y, g:i a" }}
          </span>
          <div class="small text-muted">
            {{ t.content|truncatechars:80 }}
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p>No messages yet.</p>
  {% endif %}

</div>
{% endblock %}
